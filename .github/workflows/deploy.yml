name: Deploy Midas Lifestyle Website

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        npm install -g html-validate
        npm install -g stylelint stylelint-config-standard
        
    - name: Validate HTML
      run: |
        echo "Validating HTML structure..."
        # Basic HTML validation
        if [ -f "index.html" ]; then
          echo "âœ… index.html exists"
          # Check for required meta tags
          grep -q "viewport" index.html && echo "âœ… Viewport meta tag found" || echo "âŒ Viewport meta tag missing"
          grep -q "description" index.html && echo "âœ… Description meta tag found" || echo "âŒ Description meta tag missing"
          grep -q "Midas Lifestyle" index.html && echo "âœ… Title contains Midas Lifestyle" || echo "âŒ Title missing"
        else
          echo "âŒ index.html not found"
          exit 1
        fi
        
    - name: Validate CSS
      run: |
        echo "Validating CSS structure..."
        if [ -f "styles.css" ]; then
          echo "âœ… styles.css exists"
          # Check for key CSS classes
          grep -q "gold-accent" styles.css && echo "âœ… Gold accent class found" || echo "âŒ Gold accent class missing"
          grep -q "hero-bg" styles.css && echo "âœ… Hero background class found" || echo "âŒ Hero background class missing"
        else
          echo "âŒ styles.css not found"
          exit 1
        fi
        
    - name: Validate JavaScript
      run: |
        echo "Validating JavaScript structure..."
        if [ -f "script.js" ]; then
          echo "âœ… script.js exists"
          # Check for key functions
          grep -q "openModal" script.js && echo "âœ… Modal function found" || echo "âŒ Modal function missing"
          grep -q "Swiper" script.js && echo "âœ… Swiper initialization found" || echo "âŒ Swiper initialization missing"
        else
          echo "âŒ script.js not found"
          exit 1
        fi
        
    - name: Check Netlify Configuration
      run: |
        echo "Validating Netlify configuration..."
        if [ -f "netlify.toml" ]; then
          echo "âœ… netlify.toml exists"
        else
          echo "âŒ netlify.toml not found"
          exit 1
        fi
        
        if [ -f "_redirects" ]; then
          echo "âœ… _redirects file exists"
        else
          echo "âŒ _redirects file not found"
          exit 1
        fi
        
    - name: Test File Structure
      run: |
        echo "Testing file structure..."
        echo "ğŸ“ Repository contents:"
        ls -la
        
        echo "ğŸ“„ Required files check:"
        [ -f "index.html" ] && echo "âœ… index.html" || echo "âŒ index.html"
        [ -f "styles.css" ] && echo "âœ… styles.css" || echo "âŒ styles.css"
        [ -f "script.js" ] && echo "âœ… script.js" || echo "âŒ script.js"
        [ -f "README.md" ] && echo "âœ… README.md" || echo "âŒ README.md"
        [ -f ".gitignore" ] && echo "âœ… .gitignore" || echo "âŒ .gitignore"
        [ -f "netlify.toml" ] && echo "âœ… netlify.toml" || echo "âŒ netlify.toml"
        [ -f "_redirects" ] && echo "âœ… _redirects" || echo "âŒ _redirects"
        
    - name: Performance Check
      run: |
        echo "Checking file sizes for performance..."
        echo "ğŸ“Š File sizes:"
        du -h *.html *.css *.js 2>/dev/null || echo "Some files not found"
        
        # Check if files are reasonable size
        html_size=$(stat -c%s "index.html" 2>/dev/null || echo "0")
        css_size=$(stat -c%s "styles.css" 2>/dev/null || echo "0")
        js_size=$(stat -c%s "script.js" 2>/dev/null || echo "0")
        
        echo "HTML size: ${html_size} bytes"
        echo "CSS size: ${css_size} bytes"
        echo "JS size: ${js_size} bytes"
        
        # Warn if files are too large
        [ "$html_size" -gt 100000 ] && echo "âš ï¸ HTML file is large (>100KB)" || echo "âœ… HTML file size OK"
        [ "$css_size" -gt 50000 ] && echo "âš ï¸ CSS file is large (>50KB)" || echo "âœ… CSS file size OK"
        [ "$js_size" -gt 50000 ] && echo "âš ï¸ JS file is large (>50KB)" || echo "âœ… JS file size OK"

  deploy-notification:
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Deployment Success
      run: |
        echo "ğŸš€ Deployment to Netlify triggered!"
        echo "ğŸ“ Site URL: https://midasthelifestyle.netlify.app"
        echo "ğŸ“ GitHub Pages: https://corporateguuu.github.io/MidasTheLifestyle"
        echo "âœ… All tests passed - ready for production!"
